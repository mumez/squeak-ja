'From Squeak4.2 of 4 February 2011 [latest update: #10966] on 25 March 2011 at 10:42:06 pm'!"Change Set:		TTCFontReaderFix-muDate:			25 March 2011Author:			Masashi UmezawaA quick fix for avoiding nil cmap in processCharacterMappingTable:"!!TTCFontReader methodsFor: 'as yet unclassified' stamp: 'mu 3/24/2011 22:29'!processCharacterMappingTable: entry	"Read the font's character to glyph index mapping table.	If an appropriate mapping can be found then return an association	with the format identifier and the contents of the table"	| copy initialOffset nSubTables pID sID offset cmap assoc |	initialOffset := entry offset.	entry skip: 2. "Skip table version"	nSubTables := entry nextUShort.	1 to: nSubTables do:[:i|		pID := entry nextUShort.		sID := entry nextUShort.		offset := entry nextULong.		"Check if this is either a Macintosh encoded table		or a Windows encoded table"		(pID = 1 or:[pID = 3]) ifTrue:[ |nextCmap |			"Go to the beginning of the table"			copy := entry copy.			copy offset: initialOffset + offset.			nextCmap := self decodeCmapFmtTable: copy.			"(pID = 1 and: [cmap notNil])" "Prefer Macintosh encoding over everything else"				"ifTrue: [pID -> cmap]."			(assoc notNil and: [nextCmap isNil]) ifTrue: [^ pID -> cmap].			assoc := pID -> (cmap := nextCmap). "Keep it in case we don't find a Mac encoded table"		].	].	^assoc! !