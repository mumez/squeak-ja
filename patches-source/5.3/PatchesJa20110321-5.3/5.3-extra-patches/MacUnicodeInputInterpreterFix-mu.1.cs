'From Squeak5.3 of 28 May 2021 [latest update: #19459] on 6 November 2021 at 10:19:56 pm'!"Change Set:		MacUnicodeInputInterpreterFix-muDate:			06 November 2021Author:			Masashi UmezawaSalvaged some backward compatibility code for old vm"!KeyboardInputInterpreter subclass: #MacUnicodeInputInterpreter	instanceVariableNames: 'keyValueIndex '	classVariableNames: ''	poolDictionaries: ''	category: 'Multilingual-TextConversion'!!MacUnicodeInputInterpreter methodsFor: 'version check' stamp: 'mu 11/6/2021 22:17'!majorMinorBuildFrom: aString	| tokens |	aString ifNil: [^ #(0 0 0)].	tokens := ((aString copyAfter: $]) findTokens: $ ) last findTokens: $..	(tokens second beginsWith: 'oscog') ifTrue: [ ^{tokens last asInteger. 0. 0}].	tokens :=  tokens collect: [:s | s initialIntegerOrNil ifNil: [0]].	^ ((1 to: 3) collect:[:each | tokens at: each ifAbsent:[0]]) asArray! !!MacUnicodeInputInterpreter methodsFor: 'version check' stamp: 'mu 3/21/2011 22:50'!majorMinorBuildFrom: versionString satisfies: aBlock 	| majorMinorBuild |	majorMinorBuild := self majorMinorBuildFrom: versionString.	^ aBlock valueWithArguments: majorMinorBuild! !!MacUnicodeInputInterpreter methodsFor: 'initialize-release' stamp: 'mu 11/6/2021 22:10'!initKeyValueIndex	| satisfiesVersion |	satisfiesVersion := self				majorMinorBuildFrom: Smalltalk vmVersion				satisfies: [:major :minor :build | 					major >= 4 or: [					major >= 3 and: [minor >= 8 and: [build >= 7]]]].	satisfiesVersion		ifTrue: [keyValueIndex := 6]		ifFalse: [keyValueIndex := 3]! !!MacUnicodeInputInterpreter methodsFor: 'initialize-release' stamp: 'mu 3/21/2011 17:02'!initialize	self initKeyValueIndex ! !!MacUnicodeInputInterpreter methodsFor: 'accessing' stamp: 'mu 3/21/2011 17:01'!keyValueIndex	^ keyValueIndex ifNil: [self initKeyValueIndex]! !!MacUnicodeInputInterpreter methodsFor: 'keyboard' stamp: 'mu 11/6/2021 22:18'!nextCharFrom: sensor firstEvt: evtBuf 	| keyValue mark |	keyValue := evtBuf at: self keyValueIndex.	mark := self japaneseSpecialMark: keyValue.	mark notNil		ifTrue: [^ mark].	"Smalltalk systemLanguage charsetClass charFromUnicode: keyValue."	^ Unicode value: keyValue! !KeyboardInputInterpreter subclass: #MacUnicodeInputInterpreter	instanceVariableNames: 'keyValueIndex'	classVariableNames: ''	poolDictionaries: ''	category: 'Multilingual-TextConversion'!!MacUnicodeInputInterpreter reorganize!('conversion' japaneseSpecialMark:)('version check' majorMinorBuildFrom: majorMinorBuildFrom:satisfies:)('initialize-release' initKeyValueIndex initialize)('accessing' keyValueIndex)('keyboard' nextCharFrom:firstEvt:)!