'From Squeak4.2 of 4 February 2011 [latest update: #10966] on 21 March 2011 at 10:52:53 pm'!"Change Set:		MacUnicodeInputInterpreterFix-muDate:			21 March 2011Author:			Masashi UmezawaSalvaged some backward compatibility code for old vm"!!MacUnicodeInputInterpreter methodsFor: 'version check' stamp: 'mu 3/21/2011 22:46'!majorMinorBuildFrom: aString	| tokens |	aString ifNil: [^ #(0 0 0)].	tokens := ((aString copyAfter: $]) findTokens: $ ) last findTokens: $..	tokens :=  tokens collect: [:s | s initialIntegerOrNil ifNil: [0]].	^ ((1 to: 3) collect:[:each | tokens at: each ifAbsent:[0]]) asArray! !!MacUnicodeInputInterpreter methodsFor: 'version check' stamp: 'mu 3/21/2011 22:50'!majorMinorBuildFrom: versionString satisfies: aBlock 	| majorMinorBuild |	majorMinorBuild := self majorMinorBuildFrom: versionString.	^ aBlock valueWithArguments: majorMinorBuild! !!MacUnicodeInputInterpreter methodsFor: 'initialize-release' stamp: 'mu 3/21/2011 17:01'!initKeyValueIndex	| satisfiesVersion |	satisfiesVersion := self				majorMinorBuildFrom: SmalltalkImage current vmVersion				satisfies: [:major :minor :build | 					major >= 4 or: [					major >= 3 and: [minor >= 8 and: [build >= 7]]]].	satisfiesVersion		ifTrue: [keyValueIndex := 6]		ifFalse: [keyValueIndex := 3]! !!MacUnicodeInputInterpreter methodsFor: 'initialize-release' stamp: 'mu 3/21/2011 17:02'!initialize	self initKeyValueIndex ! !!MacUnicodeInputInterpreter methodsFor: 'accessing' stamp: 'mu 3/21/2011 17:01'!keyValueIndex	^ keyValueIndex ifNil: [self initKeyValueIndex]! !!MacUnicodeInputInterpreter methodsFor: 'keyboard' stamp: 'mu 3/21/2011 16:57'!nextCharFrom: sensor firstEvt: evtBuf 	| keyValue mark |	keyValue := evtBuf at: self keyValueIndex.	mark := self japaneseSpecialMark: keyValue.	mark notNil		ifTrue: [^ mark].	keyValue < 256		ifTrue: [^ (Character value: keyValue) squeakToIso].	"Smalltalk systemLanguage charsetClass charFromUnicode: keyValue."	^ Unicode value: keyValue! !!MacUnicodeInputInterpreter reorganize!('conversion' japaneseSpecialMark:)('version check' majorMinorBuildFrom: majorMinorBuildFrom:satisfies:)('initialize-release' initKeyValueIndex initialize)('accessing' keyValueIndex)('keyboard' nextCharFrom:firstEvt:)!